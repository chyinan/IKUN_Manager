# 学生成绩管理模块优化说明

## 背景

原有的学生成绩管理模块存在以下问题：

1. 数据表结构不合理：`student_score`表中包含冗余字段`exam_type`和`exam_time`，而这些信息可以通过`exam_id`从`exam`表中获取。
2. 考试类型限制：原来只支持固定的考试类型（月考、期中、期末），不够灵活。
3. API设计不一致：前端与后端数据结构不一致，导致需要频繁进行数据转换。
4. 查询逻辑混乱：原来的成绩查询使用考试类型作为主要筛选条件，没有充分利用考试ID。

## 优化方案

### 1. 数据库表结构优化

创建了`score_structure_update.sql`文件，对`student_score`表进行优化：

- 移除冗余字段`exam_type`和`exam_time`
- 添加唯一约束确保不会有重复的学生-考试-科目组合
- 建立视图`v_student_score_by_type`提供兼容旧接口的查询功能

### 2. 后端API优化

修改了`scoreService.js`中的核心功能：

- 新增`getStudentScoreByExamId`函数，专门处理按考试ID查询成绩
- 优化`getStudentScore`函数，通过考试类型找到最新考试，再调用按考试ID查询
- 重构`saveStudentScore`函数，支持通过考试ID保存成绩

修改了`server.js`中的API路由：

- 增加`/api/score/exams`接口，返回指定考试类型的所有考试
- 支持`/api/score/student/:id`接口接收考试ID或考试类型参数
- 优化`/api/score/save`接口，简化数据结构

### 3. 前端API适配

更新了`src/api/score.ts`文件：

- 新增`testConnection`函数测试API连接
- 新增`getExams`函数获取考试列表
- 新增`getStudentScoreByExamId`函数按考试ID查询成绩
- 优化`saveStudentScore`函数，使用新的数据结构

### 4. 前端组件优化

修改了`src/views/score/index.vue`组件：

- 增加考试名称选择功能，允许用户选择特定考试
- 修改数据加载逻辑，优先使用考试ID查询成绩
- 优化成绩保存功能，使用新的API格式

## 使用指南

1. 选择班级：从下拉菜单选择学生所在班级。
2. 选择学生：选择需要查看/编辑成绩的学生。
3. 选择考试类型：选择考试类型（如月考、期中、期末等）。
4. 选择考试名称：选择具体的考试名称（如"2023年第一学期期末考试"）。
5. 查看/编辑成绩：系统会显示该学生在选定考试中的各科成绩，可以直接修改。
6. 保存成绩：点击"保存"按钮将修改后的成绩保存到数据库。

## 后续优化建议

1. 考试管理：加强对考试的管理，包括创建、编辑、删除考试。
2. 批量导入：支持批量导入学生成绩。
3. 成绩统计：增加班级和年级层面的成绩统计功能。
4. 成绩趋势：增加学生成绩趋势分析功能。
5. 权限控制：基于教师角色实现不同级别的成绩管理权限。 